name: Build iOS App

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '2.7'

      - name: Install dependencies
        run: |
          gem install bundler
          bundle install
          pod install --project-directory=./

      - name: Build app
        run: |
          xcodebuild -workspace MachiMart.xcworkspace \
                      -scheme YourSchemeName \
                      -sdk iphoneos \
                      -configuration Release \
                      clean build

      - name: Export .ipa
        run: |
          xcodebuild -exportArchive \
                      -archivePath ${{ github.workspace }}/build/YourAppName.xcarchive \
                      -exportPath ${{ github.workspace }}/build \
                      -exportOptionsPlist ${{ github.workspace }}/ExportOptions.plist

      - name: Upload artifact
        uses: actions/upload-artifact@v2
        with:
          name: YourAppName.ipa
          path: ${{ github.workspace }}/build/YourAppName.ipa
